````md
# üõ°Ô∏è helm-guard

**helm-guard** is a lightweight guardrail tool that validates Helm manifests
against live OpenShift resources **before deployment**.

It helps teams adopt Helm safely, detect configuration drift,
and gain confidence before performing a real `helm upgrade`.

---

## What is helm-guard?

helm-guard consists of **two completely decoupled components**:

* **CLI** ‚Äì performs the comparison and generates a validation report
* **UI** ‚Äì a read-only viewer for visualizing the validation report

There is **no backend**, **no database**, and **no deployment logic**.

---

## Key Principles

* ‚úîÔ∏è Validation only (no deployment)
* ‚úîÔ∏è Safe to run in CI pipelines
* ‚úîÔ∏è Works in offline / restricted environments
* ‚úîÔ∏è Designed for first-time Helm adoption
* ‚úîÔ∏è Follows SOLID and clean architecture principles

---

## What helm-guard DOES

* Renders desired state using `helm template`
* Fetches live resources from OpenShift using `oc`
* Normalizes system-generated and noisy fields
* Performs **semantic comparison** (not raw YAML diff)
* Classifies differences as:
  * `WARN` ‚Äì non-breaking drift
  * `FAIL` ‚Äì breaking or unsafe drift
* Produces:
  * Human-readable console output
  * Optional structured JSON report (for CI artifacts & UI)

---

## What helm-guard DOES NOT do

* ‚ùå Does NOT deploy anything
* ‚ùå Does NOT approve changes
* ‚ùå Does NOT modify clusters
* Does NOT validate resources outside the target namespace
* ‚ùå Does NOT require a backend server
* ‚ùå Does NOT require a database

helm-guard is a **guardrail**, not a deployment system.

---

## Comparison Modes

### 1Ô∏è‚É£ Bootstrap mode (default)

Use when Helm is introduced for the first time.

* Compares Helm-rendered manifests against **namespace-scoped resources** in the namespace
* Missing resources are treated as failures and block deployment by default
* Suitable for discovering gaps during initial Helm adoption

```bash
--mode bootstrap
````

> ‚ö†Ô∏è **Coverage note**
> helm-guard validates resources within the target namespace only.
> `oc get all` does not include Secrets, ConfigMaps, or most custom resources, so
> those may appear as missing live even if they exist.

---

### 2Ô∏è‚É£ Helm-managed mode (not yet supported)

This mode is **intentionally disabled** in the current release.

It is reserved for future steady-state Helm validation
(e.g. label-filtered comparisons or `helm diff` integration).

Attempting to run:

```bash
--mode helm-managed
```

will result in a clear validation error.

---

## CLI Usage

### Build the CLI

Node.js 18+ is required for the CLI runtime.

```bash
cd cli
npm install
npm run build
```

### Run validation

```bash
node dist/index.js \
  --chart ./path/to/chart \
  --namespace my-namespace \
  --release my-release \
  --values values.yaml \
  --values values.prod.yaml \
  --strict \
  --output ./report.json
```

The CLI always prints a readable summary to the console.
When `--output` is provided, a structured JSON report is also written to disk.
helm-guard assumes an active OpenShift context (`oc login` / `KUBECONFIG`).
Authentication is intentionally handled outside the tool.

---

### CLI Options

| Option        | Description                                  |
| ------------- | -------------------------------------------- |
| `--chart`     | Path to Helm chart directory                 |
| `--namespace` | OpenShift namespace                          |
| `--mode`      | `bootstrap` (default)                        |
| `--strict`    | Classify differences as FAIL instead of WARN |
| `--release`   | Helm release name (optional)                 |
| `--values`    | Helm values file (repeatable, order matters) |
| `--output`    | Write JSON report to file                    |

---

## Helm Rendering Parity

helm-guard renders manifests using the same inputs as a production Helm pipeline:

```
helm template [RELEASE] [CHART] -f values... --namespace ...
```

Release name and values files are critical for accurate output. Missing or mismatched
inputs often cause false-positive diffs because the rendered manifests do not match
what would be deployed. helm-guard is only as accurate as the Helm context you pass in.

---

### Exit Codes (CI-Friendly)

| Code | Meaning                                |
| ---- | -------------------------------------- |
| 0    | No differences                         |
| 1    | Warnings only                          |
| 2    | Failures or missing resources detected |
| 3    | Runtime or usage error                 |

These exit codes are designed for CI gating.

---

## UI Usage

### What the UI is

The UI is a **static, client-side application**.

It:

* Does NOT execute Helm
* Does NOT connect to OpenShift
* Does NOT perform comparisons

Its **only responsibility** is to visualize a JSON report generated by the CLI.

---

### Run the UI locally

```bash
cd ui
npm install
npm run dev
```

---

### Load a report

You can load a report in two ways:

#### 1Ô∏è‚É£ Manual upload

Upload a JSON file generated by the CLI.

#### 2Ô∏è‚É£ URL-based loading (recommended for CI)

```text
http://localhost:5173/?reportUrl=<URL_TO_report.json>
```

This is ideal for CI artifacts (e.g., GitLab job artifacts).

---

## JSON Contract

The CLI produces a JSON report consumed by the UI.

This JSON structure is a **stable public contract** shared between the CLI and UI.

* The CLI **produces** the report
* The UI **consumes** the report
* No runtime coupling exists between them

The config section may include `releaseName` and `valuesFiles` when provided.
These fields are optional and omitted when not set.
Report results contain namespace-scoped resources only, and resource keys are
formatted as `Kind/namespace/name`.

See `sample-report.json` for a complete example.

---

## CI Integration (High Level)

Typical CI flow:

1. Run `helm-guard` in a pipeline job with the same Helm parameters used for deployment

2. Write `report.json` as a job artifact

3. Publish a link to the UI with:

   ```
   ?reportUrl=<artifact URL>
   ```

4. Developers review the report visually

helm-guard is safe to run as a **pre-deployment gate**.
Exit codes are CI-friendly: 0 (clean), 1 (warnings), 2 (failures), 3 (error).

---

## Common Pitfalls / Important Notes

* Missing `-f` files leads to misleading diffs
* helm-guard does not infer environment or release context automatically
* You are responsible for passing the correct Helm inputs for parity

---

## Repository Structure

```
helm-guard/
‚îú‚îÄ‚îÄ cli/                # CLI comparison logic
‚îú‚îÄ‚îÄ shared/             # Shared report contract
‚îú‚îÄ‚îÄ ui/                 # Read-only report viewer
‚îú‚îÄ‚îÄ sample-report.json  # Example report
‚îî‚îÄ‚îÄ README.md
```

---

## Final Notes

helm-guard is intentionally minimal.

If it fails, it fails loudly.
If it warns, it warns clearly.
If it passes, you can deploy with confidence.

```
