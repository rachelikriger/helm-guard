# helm-guard

helm-guard is a lightweight guardrail tool that validates Helm manifests
against live OpenShift resources **before deployment**.

It is designed for:
- First-time Helm adoption (bootstrap)
- Ongoing validation in Helm-managed environments
- CI pipelines (GitLab CI, Jenkins, etc.)
- Offline / restricted network environments

The tool consists of:
- **CLI** – performs the comparison and produces a validation report
- **UI** – a read-only viewer for visualizing the validation report

## Core Concepts

### What helm-guard does
- Renders desired resources using `helm template`
- Fetches live resources from OpenShift using `oc`
- Normalizes system-generated fields
- Compares desired vs live state semantically
- Classifies differences as:
  - `WARN` (non-breaking)
  - `FAIL` (breaking)
- Produces:
  - Console output
  - Optional JSON report (for UI & CI artifacts)

### What helm-guard does NOT do
- Does NOT deploy anything
- Does NOT approve changes
- Does NOT modify clusters
- Does NOT require a database or backend server

## Modes

helm-guard supports two modes:

### 1. Bootstrap mode (default)
Use when Helm is introduced for the first time.

- Compares Helm output against **all resources** in the namespace
- Missing resources are treated as warnings
- Suitable for first Helm adoption

```bash
--mode bootstrap
````

### 2. Helm-managed mode

Use when services are already managed by Helm.

* Fetches only Helm-managed resources from OpenShift
* Filters by label: `app.kubernetes.io/managed-by=Helm`
* Missing resources are treated as failures

```bash
--mode helm-managed
```

## CLI Usage

### Build the CLI

```bash
cd cli
npm install
npm run build
```

### Run validation

```bash
node dist/index.js \
  --chart ./path/to/chart \
  --namespace my-namespace \
  --mode helm-managed \
  --strict \
  --output ./report.json
```

### CLI Options

| Option        | Description                                  |
| ------------- | -------------------------------------------- |
| `--chart`     | Path to Helm chart directory                 |
| `--namespace` | OpenShift namespace                          |
| `--mode`      | `bootstrap` (default) or `helm-managed`      |
| `--strict`    | Classify differences as FAIL instead of WARN |
| `--output`    | Write JSON report to file                    |

### Exit Codes

| Code | Meaning                       |
| ---- | ----------------------------- |
| 0    | No differences                |
| 1    | Warnings only                 |
| 2    | Failures or missing resources |
| 3    | Runtime or usage error        |

## UI Usage

### Run the UI

```bash
cd ui
npm install
npm run dev
```

### Load a report

You can load a report in two ways:

#### 1. Manual upload

Upload a JSON file generated by the CLI.

#### 2. URL-based loading

```text
http://localhost:5173/?reportUrl=<URL_TO_report.json>
```

This is ideal for CI artifacts.

## JSON Contract

The CLI produces a JSON report consumed by the UI.
See `sample-report.json` for a complete example.

This contract is stable and shared between CLI and UI.

## Development Notes

* No backend server
* No database
* No network calls beyond `helm` and `oc`
* Designed for offline / air-gapped environments
* Follows SOLID principles

## Repository Structure

```
helm-guard/
├── cli/                # CLI comparison logic
├── ui/                 # Read-only report viewer
├── sample-report.json  # Example report
└── README.md
```
